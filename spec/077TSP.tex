\section{Запрос и ответ службы штампов времени}\label{FMT.TSP}

\subsection{Формат запроса}

Формат запроса на получение штампа времени задается 
типом~\texttt{TimeStampReq}, который определен 
в СТБ 34.101.82. Тип описывает версию применяемого синтаксиса и 
хэш-значение данных, на которые проставляется штамп времени.

В~\texttt{TimeStampReq} должны быть опущены опциональные 
компоненты~\texttt{reqPolicy}, \texttt{nonce}, \texttt{extensions} и компонент 
\texttt{certReq}, который по умолчанию принимает значение~\texttt{FALSE}. 
%
В компоненте~\texttt{version} должно быть установлено значение~$1$.

Хэш-значение данных указывается в компоненте~\texttt{messageImprint}.
Хэш-значение сопровождается описанием алгоритма хэширования.
СШВ должна проверять соответствие алгоритма и длины хэш-значения.
СШВ должна поддерживать, по крайней мере, алгоритмы \texttt{belt-hash},
\texttt{bash384} и~\texttt{bash512} (см.~\ref{CRYPTO.Hash}).

\subsection{Формат ответа}
 
Формат ответа СШВ задается типом~\texttt{TimeStampResp}, который определен 
в СТБ 34.101.82. Форматы ответов различаются в зависимости от статуса 
обработки запроса. При успешной обработке ответ содержит статус обработки 
запроса и штамп времени. При ошибке~--- только статус обработки.

Статус обработки запроса указывается в компоненте~\texttt{status}.
%
В случае успеха вложенные в~\texttt{status} компоненты~\texttt{statusInfo} 
и~\texttt{failInfo} должны быть опущены, а вложенный
компонент~\texttt{status} должен принимать значение~\texttt{granted}.
%
Если ошибка произошла по причине загруженности сервера, 
то~\texttt{statusInfo} и~\texttt{failInfo} также должны быть опущены, 
а~\texttt{status} должен принимать значение~\texttt{waiting}.
%
При других ошибках в~\texttt{status} должно быть выбрано 
значение~\texttt{rejection}, компонент~\texttt{statusInfo}
должен быть опущен, а в~\texttt{failInfo} должен быть указан один из 
кодов ошибки, определенных в СТБ 34.101.82.

Штамп времени описывается типом~\texttt{TimeStampToken}. 
Данный тип, в свою очередь, описывает контейнер типа~\texttt{SignedData},
который определен в СТБ 34.101.23.
%
Тип~\texttt{SignedData} должен применяться с учетом его 
конкретизации в~\ref{FMT.SignedData}.

В контейнере~\texttt{SignedData} непосредственно подписывается 
значение типа~\texttt{TSTInfo}. Это значение инкапсулируется 
в~\texttt{SignedData} с идентификатором~\texttt{id-ct-TSTInfo}.

В подписываемом значении типа~\texttt{TSTInfo} должны быть опущены
все опциональные компоненты. 
%
В компоненте~\texttt{version} должно быть установлено значение~$1$,
а в компоненте~\texttt{policy}~--- значение~\texttt{bpki-role-tsa},
определенное в приложении~\ref{ASN1}.
%
В компонент~\texttt{messageImprint} должно быть перенесено
значение аналогичного компонента запроса.

