\section{Запрос на получение сертификата}\label{FMT.CSR}

Запрос на получение сертификата описывается типом 
\texttt{CertificationRequest}, который определен в СТБ 34.101.17.

Компонент \texttt{subject} запроса должен быть составлен в соответствии
с требованиями раздела~\ref{ENTITIES.Name}.

В запрос могут быть включены атрибуты, которые описываются типом 
\texttt{Attribute}, также определенном в СТБ 34.101.17,
и представляют собой пары <<идентификатор типа (компонент \texttt{type})~---
значение (компонент \texttt{value})>>. Разрешается использовать следующие 
атрибуты, определенные в~\cite{PKCS9}:
\begin{enumerate}
\item
Атрибут \texttt{challengePassword}.
Идентификатор типа равняется \verb|{1 2 840 113549 1 9 7}|.
Значение~--- строка типа \verb|UTF8String(SIZE(1..255))|.

\item
Атрибут \texttt{extensionRequest}.
Идентификатор типа равняется \verb|{1 2 840 113549 1 9 14}|.
Значение~--- структура типа \verb|Extensions|, определенного в СТБ 34.101.19.
В компонентах \verb|Extensions| указываются расширения сертификата,
которые планируется перенести в сертификат.
\end{enumerate}

\subsection{Атрибут~\texttt{challengePassword}}\label{FMT.CSR.CP}

Строка~\texttt{challengePassword} состоит из трех частей:
\begin{enumerate} 
\item[1)]
пароль отзыва сертификата. Пароль используется для отзыва сертификата
(процесс~\texttt{Revoke}, подраздел~\ref{PROCESSES.Revoke})
в тех случаях, когда личный ключ утерян и запрос на отзыв нельзя 
подписать;
\item[2)]
пароль выпуска сертификата. Пароль используется при выпуске сертификата
(процесс~\texttt{Enroll}, подраздел~\ref{PROCESSES.Enroll}),
доказывая полномочия на выпуск;
\item[3)]
дополнительная информация, которую требуется передать УЦ,
например, реквизиты платежного документа об оплате услуги (процесса).
\end{enumerate}

Любая из частей может быть опущена. Длина каждой части не должна 
превосходить~$64$ символов. Порядок частей не контролируется.
Части одного типа не должны повторяться.

Паролю отзыва должен предшествовать префикс 
\str{/RPWD:}, паролю выпуска~--- префикс~\str{/EPWD:},
дополнительной информации~--- префикс~\str{/INFO:}.

Примеры \texttt{challengePassword}:
\str{/RPWD:qwerty...}, \str{/EPWD:01234.../INFO:SN112358}.

\subsection{Атрибут~\texttt{extensionRequest}}\label{FMT.CSR.ER}

В атрибуте \texttt{extensionRequest} могут быть указаны следующие 
расширения сертификата:

\begin{enumerate}
\item 
Расширение \texttt{extKeyUsage}. Расширение указывается в тех случаях, 
когда сторона планирует выступать в роли сервера~/ клиента терминального 
режима. Соответственно расширение может содержать только идентификаторы  
\verb|bpki-eku-clientTM| / \verb|bpki-eku-serverTM| 
(см.~п.~\ref{FMT.Ext.EKU}). 

% todo: extKeyUsage vs ExtKeyUsageSyntax
% todo: дополнительные идентификаторы добавляет УЦ?

\item 
Расширение \texttt{subjectAltName}. В расширении указываются 
дополнительные идентификационные атрибуты (см. п.~\ref{ENTITIES.SAN}). 
Расширение должны включать в свои запросы TLS-сервер и КА 
\doubt{и не должны включать другие стороны}.

% todo: разрешить включать всем конечным участникам.

\item
Расширение~\texttt{certificatePolicies}. В расширении
указываются идентификаторы ролей будущего субъекта сертификата
(см.~п.~\ref{FMT.Ext.CP}).
Расширение обязаны включать в свои запросы конечные участники 
и не должны включать РУЦ и ПУЦ.
\end{enumerate}
