\chapter{Транспорт}\label{TRANSPORT}

\section{Основные положения}\label{TRANSPORT.Common}

Для реализации процессов, описанных в разделе~\ref{PROCESSES}, требуется
организовать сетевое взаимодействие с УЦ. Взаимодействие носит
клиент-серверный характер. УЦ является сервером~--- к нему приходит запрос,
он высылает ответ. В процессе  \texttt{Enroll} клиентом является РЦ,
оператор РЦ или субъект. В процессах \texttt{Chpwd}, \texttt{Reenroll},
\texttt{Spawn}, \texttt{Revoke} клиентом является субъект. В процессе
\texttt{Retrieve} (который является вспомогательным для основных процессов
\texttt{Enroll}, \texttt{Reenroll}, \texttt{Spawn}) клиентом может быть РЦ,
оператор РЦ или субъект (в зависимости от основного процесса).

Взаимодействие ведется по протоколу HTTP~\cite{HTTP}.
Использование HTTPS рекомендуется, так как повышает безопасность,
но не обязательно, так как определенный уровень безопасности и анонимности
обеспечивается на уровне форматов тела пакетов.

\section{Сетевые узлы}\label{TRANSPORT.Endpoints}

Каждый из процессов обслуживается определенным сетевым узлом.
Процессам назначаются URI, и в этих URI имена узлов являются
элементами \texttt{path}.

Имена узлов соответствуют именам процессов: 
\texttt{/enroll},
\texttt{/reenroll},
\texttt{/spawn},
\texttt{/retrieve},
\texttt{/chpwd},
\texttt{/revoke}.
%
Могут быть выделены узлы четырех сценариев процесса \texttt{Enroll}:
\texttt{/enroll1}~--- \texttt{/enroll4}.

\section{Заголовки пакета}\label{TRANSPORT.Headers}

HTTP-метод запроса должен быть \texttt{POST}.
HTTP-заголовок запроса и ответа \texttt{Content-Type} должен принимать
значение \texttt{application/cms}, определенное в~\cite{ContentTypeCms}. 

\section{Тело пакета}\label{TRANSPORT.Body}

Тело запроса и ответа HTTP~--- значение определенного типа АСН.1, 
закодированное сначала по отличительным правилам (DER), 
а затем по правилам Base64~\cite{BASE64}.

\section{Коды ответов}\label{TRANSPORT.Codes}

HTTP-код ответа должен выбираться в соответствии с~\cite{HTTP}: 
200~--- в случае успешной обработки, 
202~--- в случае отложенной обработки,
коды 400-499~--- в случае отказа в проведении операции,
коды 500-599~--- в случае непредвиденных ошибок УЦ.

HTTP-код ответа должен соответствовать содержимому ответа.

