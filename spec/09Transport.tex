\chapter{Транспорт}\label{TRANSPORT}

\section{Основные положения}\label{TRANSPORT.Common}

Для реализации процессов, определенных в~\ref{PROCESSES}, 
требуется организовать сетевое взаимодействие с УЦ. Взаимодействие носит 
клиент-серверный характер. 
%
УЦ выступает в роли сервера~--- 
получает и обрабатывает запросы, высылает ответы.
Работу УЦ как сервера поддерживают агенты.
Нужен, по крайней мере, один агент, который подписывает ответы 
формата~\texttt{BPKIResp} (см.~\ref{FMT.BPKIResp}).
%
В зависимости от процесса клиентом может быть оператор РЦ, сам РЦ или 
субъект сертификата. 

Взаимодействие между клиентом и сервером ведется по протоколу HTTP~\cite{HTTP}.
Использование определенного в СТБ 34.101.65 протокола TLS, который 
является стандартным инструментом защиты пакетов HTTP, рекомендуется, 
так как повышает безопасность, но не является обязательным:
необходимый уровень защиты сообщений обеспечивается в самих процессах. 

Протокол HTTP рекомендуется также использовать для организации 
взаимодействия с OCSP-сервером, СШВ и СЗД. 

\section{Сетевые узлы}\label{TRANSPORT.Endpoints}

Каждый из процессов, который реализует УЦ, обслуживается определенным 
сетевым узлом. Имя узла должно представлять собой URI, компонент 
\texttt{path} которого повторяет имя процесса с заменой первой прописной 
буквы на строчную и добавлением в начало наклонной черты: \str{/enroll}, 
\str{/reenroll}, \str{/spawn} и т.~д.

Для обслуживания сценариев процесса~\texttt{Enroll} могут вводиться 
отдельные сетевые узлы. Имена этим узлам назначаются по аналогичным 
правилам: компонент \texttt{path} имеют вид~\str{/enroll1}, 
\str{/enroll2} или~\str{/enroll3}.

При назначении имен узлам OCSP-серверов, СШВ и СЗД в компонентах  
\texttt{path} рекомендуется соответственно указывать~\str{/ocsp}, 
\str{/tsa} и~\str{/dvcs}.

Имена узлов, поддерживаемых УЦ, серверами и службами, могут указываться в 
расширении~\texttt{SubjectAltName} их собственных сертификатов или 
сертификатов их агентов. 

Примеры имен узлов: \str{http://bpki.by/setpwd}, 
\str{http://bpki.by/enroll3}, 
\str{http://bpki.by/tsa}.

\section{Пакеты}\label{TRANSPORT.Packets}

Запрос HTTP-серверу и соответствующий ответ представляют собой пакеты,
формат которых определен в~\cite{HTTP}.
%
Запрос должен отправляться с помощью метода~\texttt{POST}.

Заголовки пакетов СШВ и СЗД настраиваются по правилам, 
определенным в СТБ~34.101.81 и СТБ~34.101.82. 
%
Дополнительные правила:
\begin{enumerate}
\item
В запросах и ответах УЦ, при обслуживании им процессов раздела~\ref{PROCESSES},
заголовок~\texttt{Content-Type} должен принимать значение~\str{application/cms}.

\item
В запросе OCSP-серверу заголовок~\texttt{Content-Type} 
должен принимать значение \str{application/ocsp-request}.
В соответствующем ответе этот же заголовок должен принимать значение 
\str{application/ocsp-response}. 
\end{enumerate}

В теле HTTP-пакета передается определенный контейнер АСН.1.
Контейнер кодируется по правилам DER, DER-код записывается
в двоичном виде.

\section{Коды ответов}\label{TRANSPORT.Codes}

Код HTTP-ответа должен выбираться в соответствии с~\cite{HTTP}: 
200~--- в случае успешной обработки, 
202~--- в случае отложенной обработки,
коды 400-499~--- в случае отказа в проведении операции,
коды 500-599~--- в случае непредвиденных ошибок HTTP-сервера.

Код ответа должен соответствовать содержимому ответа, т.~е.
содержимому вложенного в ответ контейнера АСН.1.

