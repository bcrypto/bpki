\section{Процесс \texttt{Revoke}}\label{PROCESSES.Revoke}

Процесс~\texttt{Revoke} выполняют субъект сертификата и УЦ. 
С помощью~\texttt{Revoke} субъект отзывает свой сертификат.
Отзыв возможен, если субъект сохранил свой личный ключ и может подписать 
на нем запрос на отзыв, или если субъект предварительно связал с 
сертификатом пароль отзыва. Пароль отзыва регистрируется и обновляется
в процессах~\texttt{Enroll}, \texttt{Reenroll}, \texttt{Spawn}, 
\texttt{Chpwd}.

Процесс~\texttt{Revoke} состоит из следующих процедур:
\begin{itemize}
\item[--]
подготовка запроса на отзыв;
\item[--]
отправка запроса УЦ;
\item[--]
обработка запроса;
\item[--]
возврат ответа;
\item[--]
обработка ответа.
\end{itemize}

Запрос на отзыв представляет собой контейнер~\texttt{BPKIRevokeReq},
который определен в~\ref{FMT.BPKIRevokeReq}.
Отправитель переносит в~\texttt{BPKIRevokeReq}
идентификационные данные и серийный номер отзываемого сертификата,
указывает причину отзыва и при необходимости комментирует ее.
В компоненте~\texttt{revokePwd} контейнера указывается пароль отзыва.
Пароль можно не задавать, если личный ключ не потерян и запрос будет
подписываться. 

Запрос подписывается обязательно, если пароль отзыва не был 
зарегистрирован, и по желанию субъекта в противном случае.
%
Рекомендуется подписывать запрос всегда, когда это возможно.
%
Подписанный запрос оформляется как контейнер~\texttt{SignedData}.

Субъект конвертует запрос или подписанный запрос на открытом ключе УЦ
и отправляет его УЦ в виде контейнера~\texttt{EnvelopedData}.
Перед отправкой субъект вычисляет идентификатор конвертованного запроса,
хэшируя его с помощью~\texttt{belt-hash}.

УЦ снимает защиту с контейнера~\texttt{EnvelopedData} и определяет 
либо вложенный контейнер~\texttt{SignedData}, либо непосредственно
запрос~\texttt{BPKIRevokeReq}.

В первом случае УЦ находит в контейнере~\texttt{SignedData}
сертификат отправителя и проверяет, что сертификат действительно 
был выдан УЦ и не был отозван к текущему моменту времени. 
После этого УЦ проверяет подпись контейнера~\texttt{SignedData}. 
Наконец УЦ проверяет, что  подписан запрос~\texttt{BPKIRevokeReq} и что 
компоненты~\texttt{subject} и~\texttt{serialNumber} этого запроса 
совпадают с одноименными компонентами сертификата отправителя.

Во втором случае УЦ проверяет, что сертификат с реквизитами 
\texttt{subject} и~\texttt{serialNumber} из запроса действительно
был выдан УЦ, не был отозван и что с этим сертификатом действительно 
связан указанный в запросе пароль~\texttt{revokePwd}.

В каждом из случаев при положительном результате всех проверок
УЦ отзывает сертификат отправителя. 

УЦ возвращает статус обработки запроса в контейнере~\texttt{BPKIResp}.
Разрешены статусы~\texttt{granted} и~\texttt{rejection}.
В компоненте~\texttt{requestId} контейнера указывается идентификатор 
запроса, вычисленный УЦ с помощью~\texttt{belt-hash}.

УЦ подписывает~\texttt{BPKIResp} на своем личном ключе. Подписанный ответ 
оформляется как контейнер~\texttt{SignedData}. Контейнер отправляется 
субъекту.

Субъект проверяет подпись ответа. Если подпись действительна,
то субъект проверяет совпадение указанного в ответе 
идентификатора~\texttt{requestId} с сохраненным идентификатором запроса. 
При успешной проверке субъект разбирает статус ответа, т.е. статус отзыва 
сертификата. 

При ошибках проверки ответа субъект не может быть уверен, что УЦ обработал
его запрос и отозвал сертификат. Субъект может проверить статус отзыва
у OCSP-сервера или по актуальному СОС. Кроме этого, субъект может 
повторно выполнить~\texttt{Revoke}. 

